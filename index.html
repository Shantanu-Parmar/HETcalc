<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solenoid Magnetic Field Optimizer</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0d1b2a, #1b263b);
            color: #e0e1dd;
            overflow-x: hidden;
            position: relative;
        }
        canvas.background {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
            opacity: 0.3;
        }
        h1 {
            font-family: 'Orbitron', sans-serif;
            text-align: center;
            color: #00d4ff;
            text-shadow: 0 0 10px #00d4ff, 0 0 20px #00d4ff;
            margin-bottom: 20px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        .calculator {
            max-width: 1200px;
            margin: 0 auto;
        }
        .container {
            background: rgba(27, 38, 59, 0.9);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            margin-bottom: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .container:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.5);
        }
        .main-content {
            display: flex;
            gap: 15px;
        }
        .left-pane, .right-pane {
            flex: 1;
            min-width: 0;
        }
        .right-pane {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .restrictions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .restrictions label {
            flex: 1;
            min-width: 120px;
        }
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
        }
        label {
            font-weight: 400;
            color: #00d4ff;
            font-size: 0.9em;
            min-width: 150px;
        }
        input[type="number"], select {
            padding: 8px;
            border: none;
            border-radius: 6px;
            background: #415a77;
            color: #e0e1dd;
            font-size: 0.9em;
            width: 100px;
            transition: box-shadow 0.3s ease, transform 0.3s ease;
        }
        input[type="number"]:focus, select:focus {
            outline: none;
            box-shadow: 0 0 10px #00d4ff;
            transform: scale(1.02);
        }
        .slider-value {
            font-size: 0.8em;
            color: #778da9;
        }
        #results {
            font-size: 0.9em;
            padding: 15px;
            border-radius: 6px;
            background: rgba(0, 212, 255, 0.1);
        }
        #effectLog {
            background: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 6px;
            max-height: 200px;
            overflow-y: auto;
        }
        #effectLog table {
            width: 100%;
            border-collapse: collapse;
        }
        #effectLog th, #effectLog td {
            border: 1px solid #415a77;
            padding: 8px;
            text-align: center;
            font-size: 0.85em;
            color: #e0e1dd;
        }
        #effectLog th {
            background: #1b263b;
        }
        #effectLog td button {
            padding: 4px 8px;
            background: #ff4d6d;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #effectLog td button:hover {
            background: #ff758f;
        }
        #solenoidViz {
            display: block;
            margin: 10px auto;
            max-width: 100%;
            border: 1px solid #00d4ff;
            background: #0d1b2a;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.4);
        }
        .controls {
            text-align: center;
            margin: 10px 0;
        }
        .controls button {
            padding: 10px 20px;
            background: #00d4ff;
            border: none;
            border-radius: 6px;
            color: #0d1b2a;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease;
        }
        .controls button:hover {
            background: #80eaff;
            transform: scale(1.05);
        }
        .equations {
            background: rgba(27, 38, 59, 0.9);
            padding: 20px;
            border-radius: 12px;
            font-size: 0.85em;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
        }
        .equations h3 {
            font-family: 'Orbitron', sans-serif;
            color: #00d4ff;
        }
        .equations p {
            font-family: monospace;
            color: #e0e1dd;
            margin: 5px 0;
        }
        .green { color: #00ff9f; }
        .red { color: #ff4d6d; }
        .nudge { font-style: italic; font-size: 0.8em; color: #ff758f; }
        .tab {
            overflow: hidden;
            background: rgba(27, 38, 59, 0.9);
            border-radius: 12px 12px 0 0;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }
        .tab button {
            background: transparent;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 20px;
            color: #00d4ff;
            font-family: 'Orbitron', sans-serif;
            font-size: 1em;
            transition: background 0.3s ease, color 0.3s ease;
        }
        .tab button:hover {
            background: rgba(0, 212, 255, 0.2);
        }
        .tab button.active {
            background: #00d4ff;
            color: #0d1b2a;
        }
        .tabcontent {
            display: none;
            padding: 15px;
            border-radius: 0 0 12px 12px;
            background: rgba(27, 38, 59, 0.9);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px #00d4ff, 0 0 20px #00d4ff; }
            to { text-shadow: 0 0 15px #00d4ff, 0 0 30px #00d4ff; }
        }
        @media (max-width: 600px) {
            .main-content {
                flex-direction: column;
            }
            .left-pane, .right-pane {
                width: 100%;
            }
            .input-row {
                flex-direction: column;
                align-items: stretch;
            }
            input[type="number"], select {
                width: 100%;
            }
            .restrictions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <canvas class="background" id="backgroundCanvas"></canvas>
    <h1>Solenoid Magnetic Field Optimizer</h1>
    <div class="calculator">
        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'currentMode')">Current I Mode</button>
            <button class="tablinks" onclick="openTab(event, 'magneticFieldMode')">Magnetic Field B Mode</button>
        </div>
        <div class="main-content">
            <div class="left-pane">
                <div class="container" id="thresholds">
                    <h3>Thresholds</h3>
                    <div class="restrictions">
                        <label for="maxB">Max B (T):</label><input type="number" id="maxB" min="0" step="0.001" value="0.01">
                        <label for="maxLayers">Max Layers:</label><input type="number" id="maxLayers" min="1" value="10">
                        <label for="maxThickness">Max Thick (mm):</label><input type="number" id="maxThickness" min="0" step="0.1" value="10">
                        <label for="maxWireLength">Max Wire (m):</label><input type="number" id="maxWireLength" min="0" step="0.1" value="50">
                        <label for="maxPower">Max Power (W):</label><input type="number" id="maxPower" min="0" step="0.1" value="20">
                        <label for="maxResistance">Max Resistance (Ω):</label><input type="number" id="maxResistance" min="0" step="0.1" value="10">
                    </div>
                </div>
                <div id="currentMode" class="tabcontent" style="display: block;">
                    <div class="container" id="inputParameters">
                        <h3>Input Parameters</h3>
                        <div class="input-row"><label for="solenoidLength">Solenoid Length (cm):</label><input type="number" id="solenoidLength" value="50" step="0.1" oninput="syncInputs()"><span class="slider-value" id="solenoidLengthValue">50 cm</span></div>
                        <div class="input-row"><label for="linearOffset">Solenoid Offset (on each side) (mm):</label><input type="number" id="linearOffset" min="0" step="0.1" value="5" oninput="syncInputs()"><span class="slider-value" id="linearOffsetValue">5 mm</span></div>
                        <div class="input-row"><label for="maxOuterRadius">Solenoid Outer Radius (cm):</label><input type="number" id="maxOuterRadius" value="10" step="0.1" oninput="syncInputs()"><span class="slider-value" id="maxOuterRadiusValue">10 cm</span></div>
                        <div class="input-row"><label for="innerRadius">Solenoid Inner Radius (cm):</label><input type="number" id="innerRadius" value="5" step="0.1" oninput="syncInputs()"><span class="slider-value" id="innerRadiusValue">5 cm</span></div>
                        <div class="input-row"><label for="wireDiameter">Diameter of Wire (cm):*</label><select id="wireDiameter" onchange="toggleWireInput()">
                            <option value="0.259">10 AWG (0.259 cm bare)</option>
                            <option value="0.230">11 AWG (0.230 cm bare)</option>
                            <option value="0.205">12 AWG (0.205 cm bare)</option>
                            <option value="0.183">13 AWG (0.183 cm bare)</option>
                            <option value="0.163">14 AWG (0.163 cm bare)</option>
                            <option value="0.145">15 AWG (0.145 cm bare)</option>
                            <option value="0.129">16 AWG (0.129 cm bare)</option>
                            <option value="0.115">17 AWG (0.115 cm bare)</option>
                            <option value="0.102">18 AWG (0.102 cm bare)</option>
                            <option value="0.091">19 AWG (0.091 cm bare)</option>
                            <option value="0.081">20 AWG (0.081 cm bare)</option>
                            <option value="0.072">21 AWG (0.072 cm bare)</option>
                            <option value="0.064">22 AWG (0.064 cm bare)</option>
                            <option value="0.057">23 AWG (0.057 cm bare)</option>
                            <option value="0.051">24 AWG (0.051 cm bare)</option>
                            <option value="0.045">25 AWG (0.045 cm bare)</option>
                            <option value="0.040">26 AWG (0.040 cm bare)</option>
                            <option value="0.036">27 AWG (0.036 cm bare)</option>
                            <option value="0.032">28 AWG (0.032 cm bare)</option>
                            <option value="0.029">29 AWG (0.029 cm bare)</option>
                            <option value="0.025">30 AWG (0.025 cm bare)</option>
                            <option value="0.0227">31 AWG (0.0227 cm bare)</option>
                            <option value="0.0202">32 AWG (0.0202 cm bare)</option>
                            <option value="0.0180">33 AWG (0.0180 cm bare)</option>
                            <option value="0.0160">34 AWG (0.0160 cm bare)</option>
                            <option value="0.0143">35 AWG (0.0143 cm bare)</option>
                            <option value="0.0127">36 AWG (0.0127 cm bare)</option>
                            <option value="0.0113">37 AWG (0.0113 cm bare)</option>
                            <option value="0.0101">38 AWG (0.0101 cm bare)</option>
                            <option value="0.0090">39 AWG (0.0090 cm bare)</option>
                            <option value="0.0080">40 AWG (0.0080 cm bare)</option>
                        </select><input type="number" id="wireDiameterManual" step="0.01" placeholder="Custom" oninput="toggleWireInput()" style="width: 100px; pointer-events: auto;"><input type="number" id="wireInsulationManual" step="0.001" placeholder="Insulation (cm)" value="0.025" oninput="toggleWireInput()" onclick="this.focus()" style="width: 100px; pointer-events: auto; z-index: 1;"><span class="slider-value" id="wireDiameterValue">0.259 cm bare, 0.025 cm insulation</span></div>
                        <div class="input-row"><label for="current">Current (A):</label><input type="number" id="current" value="2" step="0.1" oninput="syncInputs()"><span class="slider-value" id="currentValue">2 A</span></div>
                        <div class="input-row"><label for="resistivity">Resistivity (×10⁻⁶ Ω·cm):</label><select id="resistivity" onchange="toggleResistivity()">
                            <option value="1.68">Copper (1.68)</option>
                            <option value="2.82">Aluminum (2.82)</option>
                            <option value="1.59">Silver (1.59)</option>
                            <option value="2.44">Gold (2.44)</option>
                        </select><input type="number" id="resistivityManual" step="0.01" placeholder="Custom" oninput="toggleResistivity()" style="width: 100px;"><span class="slider-value" id="resistivityValue">1.68 ×10⁻⁶ Ω·cm</span></div>
                        <div class="input-row"><label for="linearMassDensity">Linear Mass Density (g/cm³):</label><select id="linearMassDensity" onchange="toggleLinearMassDensity()">
                            <option value="8.92">Copper (8.92)</option>
                            <option value="2.70">Aluminum (2.70)</option>
                            <option value="10.49">Silver (10.49)</option>
                            <option value="19.32">Gold (19.32)</option>
                        </select><input type="number" id="linearMassDensityManual" step="0.01" placeholder="Custom" oninput="toggleLinearMassDensity()" style="width: 100px;"><span class="slider-value" id="linearMassDensityValue">8.92 g/cm³</span></div>
                    </div>
                </div>
                <div id="magneticFieldMode" class="tabcontent">
                    <div class="container" id="inputParametersB">
                        <h3>Input Parameters</h3>
                        <div class="input-row"><label for="solenoidLengthB">Solenoid Length (cm):</label><input type="number" id="solenoidLengthB" value="50" step="0.1" oninput="syncInputs()"><span class="slider-value" id="solenoidLengthBValue">50 cm</span></div>
                        <div class="input-row"><label for="linearOffsetB">Solenoid Offset (on each side) (mm):</label><input type="number" id="linearOffsetB" min="0" step="0.1" value="5" oninput="syncInputs()"><span class="slider-value" id="linearOffsetBValue">5 mm</span></div>
                        <div class="input-row"><label for="maxOuterRadiusB">Solenoid Outer Radius (cm):</label><input type="number" id="maxOuterRadiusB" value="10" step="0.1" oninput="syncInputs()"><span class="slider-value" id="maxOuterRadiusBValue">10 cm</span></div>
                        <div class="input-row"><label for="innerRadiusB">Solenoid Inner Radius (cm):</label><input type="number" id="innerRadiusB" value="5" step="0.1" oninput="syncInputs()"><span class="slider-value" id="innerRadiusBValue">5 cm</span></div>
                        <div class="input-row"><label for="wireDiameterB">Diameter of Wire (cm):*</label><select id="wireDiameterB" onchange="toggleWireInputB()">
                            <option value="0.259">10 AWG (0.259 cm bare)</option>
                            <option value="0.230">11 AWG (0.230 cm bare)</option>
                            <option value="0.205">12 AWG (0.205 cm bare)</option>
                            <option value="0.183">13 AWG (0.183 cm bare)</option>
                            <option value="0.163">14 AWG (0.163 cm bare)</option>
                            <option value="0.145">15 AWG (0.145 cm bare)</option>
                            <option value="0.129">16 AWG (0.129 cm bare)</option>
                            <option value="0.115">17 AWG (0.115 cm bare)</option>
                            <option value="0.102">18 AWG (0.102 cm bare)</option>
                            <option value="0.091">19 AWG (0.091 cm bare)</option>
                            <option value="0.081">20 AWG (0.081 cm bare)</option>
                            <option value="0.072">21 AWG (0.072 cm bare)</option>
                            <option value="0.064">22 AWG (0.064 cm bare)</option>
                            <option value="0.057">23 AWG (0.057 cm bare)</option>
                            <option value="0.051">24 AWG (0.051 cm bare)</option>
                            <option value="0.045">25 AWG (0.045 cm bare)</option>
                            <option value="0.040">26 AWG (0.040 cm bare)</option>
                            <option value="0.036">27 AWG (0.036 cm bare)</option>
                            <option value="0.032">28 AWG (0.032 cm bare)</option>
                            <option value="0.029">29 AWG (0.029 cm bare)</option>
                            <option value="0.025">30 AWG (0.025 cm bare)</option>
                            <option value="0.0227">31 AWG (0.0227 cm bare)</option>
                            <option value="0.0202">32 AWG (0.0202 cm bare)</option>
                            <option value="0.0180">33 AWG (0.0180 cm bare)</option>
                            <option value="0.0160">34 AWG (0.0160 cm bare)</option>
                            <option value="0.0143">35 AWG (0.0143 cm bare)</option>
                            <option value="0.0127">36 AWG (0.0127 cm bare)</option>
                            <option value="0.0113">37 AWG (0.0113 cm bare)</option>
                            <option value="0.0101">38 AWG (0.0101 cm bare)</option>
                            <option value="0.0090">39 AWG (0.0090 cm bare)</option>
                            <option value="0.0080">40 AWG (0.0080 cm bare)</option>
                        </select><input type="number" id="wireDiameterManualB" step="0.01" placeholder="Custom" oninput="toggleWireInputB()" style="width: 100px; pointer-events: auto;"><input type="number" id="wireInsulationManualB" step="0.001" placeholder="Insulation (cm)" value="0.025" oninput="toggleWireInputB()" onclick="this.focus()" style="width: 100px; pointer-events: auto; z-index: 1;"><span class="slider-value" id="wireDiameterValueB">0.259 cm bare, 0.025 cm insulation</span></div>
                        <div class="input-row"><label for="magneticField">Magnetic Field (T):</label><input type="number" id="magneticField" value="0.01" step="0.001" oninput="syncInputs()"><span class="slider-value" id="magneticFieldValue">0.01 T</span></div>
                        <div class="input-row"><label for="resistivityB">Resistivity (×10⁻⁶ Ω·cm):</label><select id="resistivityB" onchange="toggleResistivityB()">
                            <option value="1.68">Copper (1.68)</option>
                            <option value="2.82">Aluminum (2.82)</option>
                            <option value="1.59">Silver (1.59)</option>
                            <option value="2.44">Gold (2.44)</option>
                        </select><input type="number" id="resistivityManualB" step="0.01" placeholder="Custom" oninput="toggleResistivityB()" style="width: 100px;"><span class="slider-value" id="resistivityValueB">1.68 ×10⁻⁶ Ω·cm</span></div>
                        <div class="input-row"><label for="linearMassDensityB">Linear Mass Density (g/cm³):</label><select id="linearMassDensityB" onchange="toggleLinearMassDensityB()">
                            <option value="8.92">Copper (8.92)</option>
                            <option value="2.70">Aluminum (2.70)</option>
                            <option value="10.49">Silver (10.49)</option>
                            <option value="19.32">Gold (19.32)</option>
                        </select><input type="number" id="linearMassDensityManualB" step="0.01" placeholder="Custom" oninput="toggleLinearMassDensityB()" style="width: 100px;"><span class="slider-value" id="linearMassDensityValueB">8.92 g/cm³</span></div>
                    </div>
                </div>
            </div>
            <div class="right-pane">
                <div class="container" id="results">
                    <h3>Results</h3>
                    <div id="results"></div>
                </div>
                <div class="container" id="logging">
                    <h3>Logging</h3>
                    <div class="controls">
                        <button onclick="recordValues()">Record Value</button>
                        <button onclick="downloadCSV()">Download CSV</button>
                    </div>
                    <div id="effectLog">
                        <table>
                            <thead>
                                <tr>
                                    <th>Wire</th>
                                    <th>Electrical</th>
                                    <th>Magnetic</th>
                                    <th>Mechanical</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="effectLogBody"></tbody>
                        </table>
                    </div>
                </div>
                <div class="container" id="animation">
                    <h3>Animation</h3>
                    <canvas id="solenoidViz" width="600" height="400"></canvas>
                </div>
            </div>
        </div>
        <div class="equations">
            <h3>Equations Used</h3>
            <p>ntp = (L_solenoid - (2 * L_soloff)) / D_wire</p>
            <p>n_layers = (2 / sqrt(3)) * ((R_max - R_min) / D_wire - 1) + 1</p>
            <p>n_T = ntp * n_layers</p>
            <p>lw = 2 * π * ntp * n_layers * (R_min + 0.5 * D_wire + (√3 / 4) * D_wire * (n_layers - 1))</p>
            <p>A_cross = π * (D_bare / 2)²</p>
            <p>V = A_cross * lw</p>
            <p>mw = ρ * V</p>
            <p>t_total = D_wire * (1 + (√3 / 2) * (n_layers - 1)) * 10</p>
            <p>n = n_T / L_solenoid</p>
            <p>Current I Mode: B = μ₀ * n * I</p>
            <p>Magnetic Field B Mode: I = B / (μ₀ * n)</p>
            <p>R = ρ * lw / A_cross</p>
            <p>P = I² * R</p>
            <p>Assumptions: Hexagonal packing of wires. The wire length formula uses an average radius approximation, assuming constant turns per layer (ntp). Density (ρ) is user-selected (g/cm³). Resistivity (ρ) is user-selected (×10⁻⁶ Ω·cm, converted to Ω·m). μ₀ = 4π × 10⁻⁷ H/m. All lengths are in meters, density in g/cm³, thickness in mm, magnetic field in tesla, resistance in ohms, and power in watts.</p>
            <p>* Wire diameters based on annealed copper at 20 °C from "Copper wire tables," United States National Bureau of Standards, 1914, https://nvlpubs.nist.gov/nistpubs/Legacy/hb/nbshandbook100.pdf</p>
        </div>
    </div>

    <script>
        let global_ntp = 0;
        let global_nlayers = 0;
        let activeTab = 'currentMode';
        let pulsePhase = 0;

        // Background animation
        const bgCanvas = document.getElementById('backgroundCanvas');
        const bgCtx = bgCanvas.getContext('2d');
        let particles = [];

        function initBackground() {
            bgCanvas.width = window.innerWidth;
            bgCanvas.height = window.innerHeight;
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: Math.random() * bgCanvas.width,
                    y: Math.random() * bgCanvas.height,
                    radius: Math.random() * 3 + 1,
                    vx: Math.random() * 2 - 1,
                    vy: Math.random() * 2 - 1,
                    color: `rgba(0, ${Math.random() * 100 + 155}, 255, 0.7)`
                });
            }
            animateBackground();
        }

        function animateBackground() {
            bgCtx.clearRect(0, 0, bgCanvas.width, bgCanvas.height);
            particles.forEach(p => {
                p.x += p.vx;
                p.y += p.vy;
                if (p.x < 0 || p.x > bgCanvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > bgCanvas.height) p.vy *= -1;
                bgCtx.beginPath();
                bgCtx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                bgCtx.fillStyle = p.color;
                bgCtx.fill();
            });
            particles.forEach((p, i) => {
                particles.forEach((p2, j) => {
                    if (i >= j) return;
                    const dx = p.x - p2.x;
                    const dy = p.y - p2.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 100) {
                        bgCtx.beginPath();
                        bgCtx.moveTo(p.x, p.y);
                        bgCtx.lineTo(p2.x, p2.y);
                        bgCtx.strokeStyle = `rgba(0, 212, 255, ${1 - dist / 100})`;
                        bgCtx.lineWidth = 1;
                        bgCtx.stroke();
                    }
                });
            });
            requestAnimationFrame(animateBackground);
        }

        window.addEventListener('resize', () => {
            bgCanvas.width = window.innerWidth;
            bgCanvas.height = window.innerHeight;
        });

        function openTab(evt, tabName) {
            const tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            const tablinks = document.getElementsByClassName("tablinks");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            activeTab = tabName;
            syncInputs();
        }

        function updateDynamicRange(sliderId, value, suffix) {
            document.getElementById(sliderId + 'Value').textContent = value + (suffix || '');
        }

        function syncInputs() {
            const isCurrentMode = activeTab === 'currentMode';
            const inputs = isCurrentMode ?
                ['solenoidLength', 'linearOffset', 'maxOuterRadius', 'innerRadius', 'wireDiameter', 'current', 'resistivity', 'linearMassDensity'] :
                ['solenoidLengthB', 'linearOffsetB', 'maxOuterRadiusB', 'innerRadiusB', 'wireDiameterB', 'magneticField', 'resistivityB', 'linearMassDensityB'];
            
            inputs.forEach(id => {
                let value = document.getElementById(id).value;
                if (id.includes('wireDiameter')) {
                    const suffix = isCurrentMode ? '' : 'B';
                    const insulation = parseFloat(document.getElementById('wireInsulationManual' + suffix).value) || 0.025;
                    value = document.getElementById('wireDiameter' + suffix).value || document.getElementById('wireDiameterManual' + suffix).value || '0.259';
                    document.getElementById('wireDiameterManual' + suffix).value = value !== document.getElementById('wireDiameter' + suffix).value ? value : '';
                    document.getElementById('wireDiameter' + suffix).value = value === document.getElementById('wireDiameterManual' + suffix).value ? '' : value;
                    document.getElementById('wireDiameterValue' + suffix).textContent = value + ' cm bare, ' + insulation + ' cm insulation';
                } else if (id.includes('resistivity')) {
                    const suffix = isCurrentMode ? '' : 'B';
                    value = document.getElementById('resistivity' + suffix).value || document.getElementById('resistivityManual' + suffix).value || '1.68';
                    document.getElementById('resistivityManual' + suffix).value = value !== document.getElementById('resistivity' + suffix).value ? value : '';
                    document.getElementById('resistivity' + suffix).value = value === document.getElementById('resistivityManual' + suffix).value ? '' : value;
                    document.getElementById('resistivityValue' + suffix).textContent = value + ' ×10⁻⁶ Ω·cm';
                } else if (id.includes('linearMassDensity')) {
                    const suffix = isCurrentMode ? '' : 'B';
                    value = document.getElementById('linearMassDensity' + suffix).value || document.getElementById('linearMassDensityManual' + suffix).value || '8.92';
                    document.getElementById('linearMassDensityManual' + suffix).value = value !== document.getElementById('linearMassDensity' + suffix).value ? value : '';
                    document.getElementById('linearMassDensity' + suffix).value = value === document.getElementById('linearMassDensityManual' + suffix).value ? '' : value;
                    document.getElementById('linearMassDensityValue' + suffix).textContent = value + ' g/cm³';
                } else {
                    document.getElementById(id).value = value;
                    updateDynamicRange(id, parseFloat(value), 
                        id.includes('solenoidLength') ? ' cm' : 
                        id.includes('linearOffset') ? ' mm' : 
                        id.includes('maxOuterRadius') || id.includes('innerRadius') ? ' cm' : 
                        id === 'current' ? ' A' : 
                        id === 'magneticField' ? ' T' : '');
                }
            });
            calculate();
        }

        function toggleWireInput() {
            const dropdown = document.getElementById('wireDiameter');
            const manual = document.getElementById('wireDiameterManual');
            const insulation = document.getElementById('wireInsulationManual');
            const value = manual.value && manual.value !== '' ? manual.value : dropdown.value || '0.259';
            const insulValue = insulation.value || '0.025';
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
            }
            document.getElementById('wireDiameterValue').textContent = value + ' cm bare, ' + insulValue + ' cm insulation';
            syncInputs();
        }

        function toggleWireInputB() {
            const dropdown = document.getElementById('wireDiameterB');
            const manual = document.getElementById('wireDiameterManualB');
            const insulation = document.getElementById('wireInsulationManualB');
            const value = manual.value && manual.value !== '' ? manual.value : dropdown.value || '0.259';
            const insulValue = insulation.value || '0.025';
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
            }
            document.getElementById('wireDiameterValueB').textContent = value + ' cm bare, ' + insulValue + ' cm insulation';
            syncInputs();
        }

        function toggleResistivity() {
            const dropdown = document.getElementById('resistivity');
            const manual = document.getElementById('resistivityManual');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('resistivityValue').textContent = manual.value + ' ×10⁻⁶ Ω·cm';
            } else if (dropdown.value) {
                manual.value = '';
                document.getElementById('resistivityValue').textContent = dropdown.value + ' ×10⁻⁶ Ω·cm';
            }
            syncInputs();
        }

        function toggleResistivityB() {
            const dropdown = document.getElementById('resistivityB');
            const manual = document.getElementById('resistivityManualB');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('resistivityValueB').textContent = manual.value + ' ×10⁻⁶ Ω·cm';
            } else if (dropdown.value) {
                manual.value = '';
                document.getElementById('resistivityValueB').textContent = dropdown.value + ' ×10⁻⁶ Ω·cm';
            }
            syncInputs();
        }

        function toggleLinearMassDensity() {
            const dropdown = document.getElementById('linearMassDensity');
            const manual = document.getElementById('linearMassDensityManual');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('linearMassDensityValue').textContent = manual.value + ' g/cm³';
            } else if (dropdown.value) {
                manual.value = '';
                document.getElementById('linearMassDensityValue').textContent = dropdown.value + ' g/cm³';
            }
            syncInputs();
        }

        function toggleLinearMassDensityB() {
            const dropdown = document.getElementById('linearMassDensityB');
            const manual = document.getElementById('linearMassDensityManualB');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('linearMassDensityValueB').textContent = manual.value + ' g/cm³';
            } else if (dropdown.value) {
                manual.value = '';
                document.getElementById('linearMassDensityValueB').textContent = dropdown.value + ' g/cm³';
            }
            syncInputs();
        }

        function calculate() {
            const isCurrentMode = activeTab === 'currentMode';
            const prefix = isCurrentMode ? '' : 'B';
            const solenoidLength = parseFloat(document.getElementById('solenoidLength' + prefix).value) / 100; // Convert cm to m
            const linearOffset = parseFloat(document.getElementById('linearOffset' + prefix).value) / 1000; // Convert mm to m
            const maxOuterRadius = parseFloat(document.getElementById('maxOuterRadius' + prefix).value) / 100; // Convert cm to m
            const innerRadius = parseFloat(document.getElementById('innerRadius' + prefix).value) / 100; // Convert cm to m
            const bareDiameter = parseFloat(document.getElementById('wireDiameter' + prefix).value || document.getElementById('wireDiameterManual' + prefix).value || '0.259'); // cm
            const wireInsulation = parseFloat(document.getElementById('wireInsulationManual' + prefix).value) || 0.025; // cm
            const effectiveDiameter = bareDiameter + wireInsulation; // cm
            const effectiveDiameterM = effectiveDiameter / 100; // m
            const bareDiameterM = bareDiameter / 100; // m
            const linearMassDensity = parseFloat(document.getElementById('linearMassDensity' + prefix).value || document.getElementById('linearMassDensityManual' + prefix).value || '8.92'); // g/cm³
            const resistivity = parseFloat(document.getElementById('resistivity' + prefix).value || document.getElementById('resistivityManual' + prefix).value || '1.68') * 1e-8; // Convert ×10⁻⁶ Ω·cm to Ω·m
            const current = isCurrentMode ? parseFloat(document.getElementById('current').value) || 2 : null; // A
            const magneticField = !isCurrentMode ? parseFloat(document.getElementById('magneticField').value) || 0.01 : null; // T
            const maxLayersInput = parseFloat(document.getElementById('maxLayers').value) || Infinity;
            const maxThickness = parseFloat(document.getElementById('maxThickness').value) || Infinity;
            const maxWireLength = parseFloat(document.getElementById('maxWireLength').value) || Infinity;
            const maxB = parseFloat(document.getElementById('maxB').value) || Infinity;
            const maxPower = parseFloat(document.getElementById('maxPower').value) || Infinity;
            const maxResistance = parseFloat(document.getElementById('maxResistance').value) || Infinity;

            const ntp = Math.floor((solenoidLength - (2 * linearOffset)) / effectiveDiameterM);
            const nlayers = Math.floor(((2 / Math.sqrt(3)) * ((maxOuterRadius - innerRadius) / effectiveDiameterM - 1)) + 1);
            const nT = ntp * nlayers;

            const lw = 2 * Math.PI * ntp * nlayers * (innerRadius + 0.5 * effectiveDiameterM + (Math.sqrt(3) / 4) * effectiveDiameterM * (nlayers - 1)); // m
            const crossSectionArea = Math.PI * Math.pow((bareDiameterM / 2), 2); // m²
            const volume = crossSectionArea * lw; // m³
            const mw = linearMassDensity * volume * 1e6 / 1000; // kg

            const totalThickness = effectiveDiameter * (1 + ((Math.sqrt(3) / 2) * (nlayers - 1))) * 10; // mm

            const n = (ntp * nlayers) / solenoidLength; // turns per meter
            const mu0 = 4 * Math.PI * 1e-7; // H/m
            let B, I;
            if (isCurrentMode) {
                I = current;
                B = mu0 * n * I; // T
            } else {
                B = magneticField;
                I = B / (mu0 * n); // A
            }
            const R = resistivity * lw / crossSectionArea; // Ω 
            const P = I * I * R; // W

            const layersClass = nlayers > maxLayersInput ? 'red' : 'green';
            const thicknessClass = totalThickness > maxThickness ? 'red' : 'green';
            const wireLengthClass = lw > maxWireLength ? 'red' : 'green';
            const bClass = B > maxB ? 'red' : 'green';
            const resistanceClass = R > maxResistance ? 'red' : 'green';
            const powerClass = P > maxPower ? 'red' : 'green';

            const nudge = (nlayers > maxLayersInput || totalThickness > maxThickness || lw > maxWireLength || B > maxB || R > maxResistance || P > maxPower) ? 
                '<div class="nudge">Adjust inputs to meet restrictions.</div>' : '';

            document.getElementById('results').innerHTML = `
                <strong>Results:</strong><br>
                Number of Turns per Layer: ${ntp.toFixed(2)}<br>
                Number of Layers: <span class="${layersClass}">${nlayers.toFixed(0)}</span><br>
                Total Number of Turns: ${nT.toFixed(2)}<br>
                Wire Length: <span class="${wireLengthClass}">${lw.toFixed(2)}</span> m<br>
                Total Mass of Coil: ${mw.toFixed(2)} kg<br>
                Total Thickness: <span class="${thicknessClass}">${totalThickness.toFixed(2)}</span> mm<br>
                Magnetic Field: <span class="${bClass}">${B.toFixed(10)}</span> T<br>
                Current: ${I.toFixed(2)} A<br>
                Resistance: <span class="${resistanceClass}">${R.toFixed(2)}</span> Ω<br>
                Power: <span class="${powerClass}">${P.toFixed(2)}</span> W
                ${nudge}
            `;

            global_ntp = ntp;
            global_nlayers = nlayers;

            drawAnimation();
        }

        function recordValues() {
            const isCurrentMode = activeTab === 'currentMode';
            const prefix = isCurrentMode ? '' : 'B';
            const solenoidLength = parseFloat(document.getElementById('solenoidLength' + prefix).value);
            const linearOffset = parseFloat(document.getElementById('linearOffset' + prefix).value) / 10;
            const maxOuterRadius = parseFloat(document.getElementById('maxOuterRadius' + prefix).value);
            const innerRadius = parseFloat(document.getElementById('innerRadius' + prefix).value);
            const wireDiameter = parseFloat(document.getElementById('wireDiameter' + prefix).value || document.getElementById('wireDiameterManual' + prefix).value || '0.259');
            const resistivity = parseFloat(document.getElementById('resistivity' + prefix).value || document.getElementById('resistivityManual' + prefix).value || '1.68') * 1e-6;
            const linearMassDensity = parseFloat(document.getElementById('linearMassDensity' + prefix).value || document.getElementById('linearMassDensityManual' + prefix).value || '8.92');
            
            const wireColumn = `Wire Diameter: ${wireDiameter.toFixed(4)} cm`;
            let electricalColumn, magneticColumn;
            if (isCurrentMode) {
                const current = parseFloat(document.getElementById('current').value);
                electricalColumn = `Current: ${current.toFixed(2)} A, Resistivity: ${resistivity.toFixed(2)} ×10⁻⁶ Ω·cm`;
                magneticColumn = `N/A`;
            } else {
                const magneticField = parseFloat(document.getElementById('magneticField').value);
                const n = global_ntp * global_nlayers / (solenoidLength / 100);
                const mu0 = 4 * Math.PI * 1e-7;
                const current = magneticField / (mu0 * n);
                electricalColumn = `Current: ${current.toFixed(2)} A, Resistivity: ${resistivity.toFixed(2)} ×10⁻⁶ Ω·cm`;
                magneticColumn = `Magnetic Field: ${magneticField.toFixed(10)} T`;
            }
            const mechanicalColumn = `Solenoid Length: ${solenoidLength.toFixed(2)} cm, Offset: ${linearOffset.toFixed(2)} cm`;

            const row = `<tr>
                <td>${wireColumn}</td>
                <td>${electricalColumn}</td>
                <td>${magneticColumn}</td>
                <td>${mechanicalColumn}</td>
                <td><button onclick="this.parentElement.parentElement.remove()">Delete</button></td>
            </tr>`;
            document.getElementById('effectLogBody').insertAdjacentHTML('afterbegin', row);
        }

        function downloadCSV() {
            const rows = Array.from(document.querySelectorAll('#effectLogBody tr'));
            const csv = [
                ['Wire (Diameter cm)', 'Electrical (Current A, Resistivity ×10⁻⁶ Ω·cm)', 'Magnetic', 'Mechanical (Solenoid Length cm, Offset cm)'].join(','),
                ...rows.map(row => Array.from(row.cells).slice(0, -1).map(cell => `"${cell.textContent}"`).join(','))
            ].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'solenoid_data.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        const canvas = document.getElementById('solenoidViz');
        const ctx = canvas.getContext('2d');

        function drawAnimation() {
            const isCurrentMode = activeTab === 'currentMode';
            const prefix = isCurrentMode ? '' : 'B';
            const L_solenoid_cm = parseFloat(document.getElementById('solenoidLength' + prefix).value) || 50;
            const L_soloff_mm = parseFloat(document.getElementById('linearOffset' + prefix).value) || 5;
            const R_max_cm = parseFloat(document.getElementById('maxOuterRadius' + prefix).value) || 10;
            const R_min_cm = parseFloat(document.getElementById('innerRadius' + prefix).value) || 5;
            const bare_cm = parseFloat(document.getElementById('wireDiameter' + prefix).value || document.getElementById('wireDiameterManual' + prefix).value || 0.259);
            const insul_cm = parseFloat(document.getElementById('wireInsulationManual' + prefix).value) || 0.025;
            const D_wire_cm = bare_cm + insul_cm;

            const L_soloff_cm = L_soloff_mm / 10;

            const display_turns = global_ntp;
            const n_layers = global_nlayers;

            const L_for_scale = Math.min(L_solenoid_cm, 50);
            const thickness_for_scale = Math.min(R_max_cm - R_min_cm, 100);

            const scale_x = (canvas.width - 100) / L_for_scale;
            const scale_y = (canvas.height - 100) / thickness_for_scale;
            const scale = Math.min(scale_x, scale_y, 20);

            const D_wire_px = D_wire_cm * scale;
            const radius_px = D_wire_px / 2;
            const layer_spacing_px = D_wire_px * (Math.sqrt(3) / 2);
            let L_px = L_solenoid_cm * scale;
            let thickness_px = (R_max_cm - R_min_cm) * scale;
            const off_px = L_soloff_cm * scale;

            const x_start = 50;
            let x_end = x_start + L_px;
            const y_bottom = canvas.height - 50;
            let y_top = y_bottom - thickness_px;

            if (x_end > canvas.width - 50) {
                x_end = canvas.width - 50;
            }
            if (y_top < 50) {
                y_top = 50;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(x_start, y_bottom);
            ctx.lineTo(x_end, y_bottom);
            ctx.moveTo(x_start, y_top);
            ctx.lineTo(x_end, y_top);
            ctx.stroke();

            ctx.fillStyle = '#e0e1dd';
            ctx.font = '14px Orbitron';
            ctx.textAlign = 'right';
            ctx.fillText('Rmin', x_start - 10, y_bottom + 5);
            ctx.fillText('Rmax', x_start - 10, y_top + 5);

            ctx.textAlign = 'center';
            ctx.fillText('Lsolenoid', (x_start + x_end) / 2, y_bottom + 25);

            const vert_x = x_end + 20;
            ctx.beginPath();
            ctx.moveTo(vert_x, y_top);
            ctx.lineTo(vert_x, y_bottom);
            ctx.stroke();

            ctx.save();
            ctx.translate(vert_x + 15, (y_top + y_bottom) / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.textAlign = 'center';
            ctx.fillText('coil thickness', 0, 0);
            ctx.restore();

            let patternCanvas = document.createElement('canvas');
            patternCanvas.width = 12;
            patternCanvas.height = 12;
            let pctx = patternCanvas.getContext('2d');
            pctx.fillStyle = '#ff9e00';
            pctx.fillRect(0, 0, 12, 12);
            pctx.strokeStyle = '#cc7a00';
            pctx.lineWidth = 1.5;
            for (let i = 0; i < 12; i += 4) {
                pctx.beginPath();
                pctx.moveTo(0, i);
                pctx.lineTo(12, i);
                pctx.stroke();
            }

            const pattern = ctx.createPattern(patternCanvas, 'repeat');
            pulsePhase = (pulsePhase + 0.05) % (2 * Math.PI);

            for (let layer = 0; layer < n_layers; layer++) {
                const y = y_bottom - radius_px - layer * layer_spacing_px;
                if (y - radius_px < y_top) continue;

                const shift = (layer % 2 === 1) ? radius_px : 0;

                for (let turn = 0; turn < display_turns; turn++) {
                    const x = x_start + off_px + radius_px + turn * D_wire_px + shift;
                    if (x + radius_px > x_end) continue;

                    ctx.beginPath();
                    ctx.arc(x, y, radius_px, 0, 2 * Math.PI);
                    ctx.fillStyle = pattern;
                    ctx.fill();
                    ctx.strokeStyle = '#ff9e00';
                    ctx.lineWidth = 1;
                    ctx.stroke();

                    // Glowing pulse effect
                    const glowIntensity = 0.5 + 0.5 * Math.sin(pulsePhase + turn * 0.2);
                    ctx.beginPath();
                    ctx.arc(x, y, radius_px + 2, 0, 2 * Math.PI);
                    ctx.strokeStyle = `rgba(0, 212, 255, ${glowIntensity * 0.3})`;
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }
            }

            requestAnimationFrame(drawAnimation);
        }

        document.getElementById('solenoidLength').addEventListener('input', syncInputs);
        document.getElementById('linearOffset').addEventListener('input', syncInputs);
        document.getElementById('maxOuterRadius').addEventListener('input', syncInputs);
        document.getElementById('innerRadius').addEventListener('input', syncInputs);
        document.getElementById('wireDiameter').addEventListener('change', syncInputs);
        document.getElementById('wireDiameterManual').addEventListener('input', syncInputs);
        document.getElementById('wireInsulationManual').addEventListener('input', syncInputs);
        document.getElementById('current').addEventListener('input', syncInputs);
        document.getElementById('resistivity').addEventListener('change', syncInputs);
        document.getElementById('resistivityManual').addEventListener('input', syncInputs);
        document.getElementById('linearMassDensity').addEventListener('change', syncInputs);
        document.getElementById('linearMassDensityManual').addEventListener('input', syncInputs);

        document.getElementById('solenoidLengthB').addEventListener('input', syncInputs);
        document.getElementById('linearOffsetB').addEventListener('input', syncInputs);
        document.getElementById('maxOuterRadiusB').addEventListener('input', syncInputs);
        document.getElementById('innerRadiusB').addEventListener('input', syncInputs);
        document.getElementById('wireDiameterB').addEventListener('change', syncInputs);
        document.getElementById('wireDiameterManualB').addEventListener('input', syncInputs);
        document.getElementById('wireInsulationManualB').addEventListener('input', syncInputs);
        document.getElementById('magneticField').addEventListener('input', syncInputs);
        document.getElementById('resistivityB').addEventListener('change', syncInputs);
        document.getElementById('resistivityManualB').addEventListener('input', syncInputs);
        document.getElementById('linearMassDensityB').addEventListener('change', syncInputs);
        document.getElementById('linearMassDensityManualB').addEventListener('input', syncInputs);

        window.onload = () => {
            initBackground();
            syncInputs();
        };
    </script>
</body>
</html>