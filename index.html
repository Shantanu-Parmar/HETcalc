<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solenoid Magnetic Field Optimizer</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: url('https://source.unsplash.com/random/1920x1080/?tech,abstract') no-repeat center center fixed;
            background-size: cover;
            color: #333;
        }
        h1 {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .main-content {
            display: flex;
            gap: 10px;
        }
        .left-pane {
            flex: 1;
            min-width: 0;
        }
        .right-pane {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .restrictions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .restrictions label {
            flex: 1;
            min-width: 120px;
        }
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }
        label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9em;
            min-width: 150px;
        }
        input[type="number"], select {
            padding: 6px;
            margin: 2px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 0.9em;
            width: 80px;
        }
        .slider-value {
            font-size: 0.8em;
            color: #555;
            margin-left: 10px;
        }
        #results {
            margin: 0;
            font-size: 0.9em;
            padding: 10px;
            border-radius: 6px;
        }
        #effectLog {
            margin: 0;
            background: #fff;
            padding: 10px;
            border-radius: 6px;
            max-height: 150px;
            overflow-y: auto;
        }
        #effectLog table {
            width: 100%;
            border-collapse: collapse;
        }
        #effectLog th, #effectLog td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
            font-size: 0.9em;
        }
        #effectLog td button {
            padding: 2px 5px;
            font-size: 0.7em;
        }
        canvas {
            display: none;
        }
        .controls {
            text-align: center;
            margin: 10px 0;
        }
        .equations {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
        }
        .equations h3 {
            margin-top: 0;
        }
        .equations p {
            margin: 5px 0;
            font-family: monospace;
        }
        .green { color: green; }
        .red { color: red; }
        .nudge { font-style: italic; font-size: 0.8em; color: #e74c3c; }
        @media (max-width: 600px) {
            .main-content {
                flex-direction: column;
            }
            .left-pane, .right-pane {
                width: 100%;
            }
            .input-row {
                flex-direction: column;
                align-items: stretch;
            }
            input[type="number"], select {
                width: 100%;
            }
            .restrictions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>Solenoid Magnetic Field Optimizer</h1>
    <div class="calculator">
        <div class="main-content">
            <div class="left-pane">
                <div class="container" id="thresholds">
                    <h3>Thresholds</h3>
                    <div class="restrictions">
                        <label for="maxB">Max B (T):</label><input type="number" id="maxB" min="0" step="0.001" value="0.01">
                        <label for="maxLayers">Max Layers:</label><input type="number" id="maxLayers" min="1" value="10">
                        <label for="maxThickness">Max Thick (mm):</label><input type="number" id="maxThickness" min="0" step="0.1" value="10">
                        <label for="maxWireLength">Max Wire (m):</label><input type="number" id="maxWireLength" min="0" step="0.1" value="50">
                        <label for="maxPower">Max Power (W):</label><input type="number" id="maxPower" min="0" step="0.1" value="20">
                        <label for="maxResistance">Max Resistance (Ω):</label><input type="number" id="maxResistance" min="0" step="0.1" value="10">
                    </div>
                </div>
                <div class="container" id="inputParameters">
                    <h3>Input Parameters</h3>
                    <div class="input-row"><label for="solenoidLength">Solenoid Length (cm):</label><input type="number" id="solenoidLength" value="50" step="0.1" oninput="syncInputs()"><span class="slider-value" id="solenoidLengthValue">50 cm</span></div>
                    <div class="input-row"><label for="linearOffset">Solenoid Offset (on each side) (mm):</label><input type="number" id="linearOffset" min="0" step="0.1" value="5" oninput="syncInputs()"><span class="slider-value" id="linearOffsetValue">5 mm</span></div>
                    <div class="input-row"><label for="maxOuterRadius">Solenoid Outer Radius (cm):</label><input type="number" id="maxOuterRadius" value="10" step="0.1" oninput="syncInputs()"><span class="slider-value" id="maxOuterRadiusValue">10 cm</span></div>
                    <div class="input-row"><label for="innerRadius">Solenoid Inner Radius (cm):</label><input type="number" id="innerRadius" value="5" step="0.1" oninput="syncInputs()"><span class="slider-value" id="innerRadiusValue">5 cm</span></div>
                    <div class="input-row"><label for="wireDiameter">Diameter of Wire (cm):*</label><select id="wireDiameter" onchange="toggleWireInput()">
                        <option value="0.259">10 AWG (0.259 cm bare)</option>
                        <option value="0.230">11 AWG (0.230 cm bare)</option>
                        <option value="0.205">12 AWG (0.205 cm bare)</option>
                        <option value="0.183">13 AWG (0.183 cm bare)</option>
                        <option value="0.163">14 AWG (0.163 cm bare)</option>
                        <option value="0.145">15 AWG (0.145 cm bare)</option>
                        <option value="0.129">16 AWG (0.129 cm bare)</option>
                        <option value="0.115">17 AWG (0.115 cm bare)</option>
                        <option value="0.102">18 AWG (0.102 cm bare)</option>
                        <option value="0.091">19 AWG (0.091 cm bare)</option>
                        <option value="0.081">20 AWG (0.081 cm bare)</option>
                        <option value="0.072">21 AWG (0.072 cm bare)</option>
                        <option value="0.064">22 AWG (0.064 cm bare)</option>
                        <option value="0.057">23 AWG (0.057 cm bare)</option>
                        <option value="0.051">24 AWG (0.051 cm bare)</option>
                        <option value="0.045">25 AWG (0.045 cm bare)</option>
                        <option value="0.040">26 AWG (0.040 cm bare)</option>
                        <option value="0.036">27 AWG (0.036 cm bare)</option>
                        <option value="0.032">28 AWG (0.032 cm bare)</option>
                        <option value="0.029">29 AWG (0.029 cm bare)</option>
                        <option value="0.025">30 AWG (0.025 cm bare)</option>
                        <option value="0.0227">31 AWG (0.0227 cm bare)</option>
                        <option value="0.0202">32 AWG (0.0202 cm bare)</option>
                        <option value="0.0180">33 AWG (0.0180 cm bare)</option>
                        <option value="0.0160">34 AWG (0.0160 cm bare)</option>
                        <option value="0.0143">35 AWG (0.0143 cm bare)</option>
                        <option value="0.0127">36 AWG (0.0127 cm bare)</option>
                        <option value="0.0113">37 AWG (0.0113 cm bare)</option>
                        <option value="0.0101">38 AWG (0.0101 cm bare)</option>
                        <option value="0.0090">39 AWG (0.0090 cm bare)</option>
                        <option value="0.0080">40 AWG (0.0080 cm bare)</option>
                    </select><input type="number" id="wireDiameterManual" step="0.01" placeholder="Custom" oninput="toggleWireInput()" style="width: 80px;"><input type="number" id="wireInsulationManual" step="0.001" placeholder="Insulation (cm)" value="0.025" oninput="toggleWireInput()" style="width: 80px;"><span class="slider-value" id="wireDiameterValue">0.259 cm bare, 0.025 cm insulation</span></div>
                    <div class="input-row"><label for="current">Current (A):</label><input type="number" id="current" value="2" step="0.1" oninput="syncInputs()"><span class="slider-value" id="currentValue">2 A</span></div>
                    <div class="input-row"><label for="resistivity">Resistivity (×10⁻⁶ Ω·cm):</label><select id="resistivity" onchange="toggleResistivity()">
                        <option value="1.68">Copper (1.68)</option>
                        <option value="2.82">Aluminum (2.82)</option>
                        <option value="1.59">Silver (1.59)</option>
                        <option value="2.44">Gold (2.44)</option>
                    </select><input type="number" id="resistivityManual" step="0.01" placeholder="Custom" oninput="toggleResistivity()" style="width: 80px;"><span class="slider-value" id="resistivityValue">1.68 ×10⁻⁶ Ω·cm</span></div>
                    <div class="input-row"><label for="linearMassDensity">Linear Mass Density (g/cm):</label><select id="linearMassDensity" onchange="toggleLinearMassDensity()">
                        <option value="8.9">Copper (8.9)</option>
                        <option value="2.7">Aluminum (2.7)</option>
                        <option value="10.36">Silver (10.36)</option>
                        <option value="19.32">Gold (19.32)</option>
                    </select><input type="number" id="linearMassDensityManual" step="0.01" placeholder="Custom" oninput="toggleLinearMassDensity()" style="width: 80px;"><span class="slider-value" id="linearMassDensityValue">8.9 g/cm</span></div>
                </div>
            </div>
            <div class="right-pane">
                <div class="container" id="results">
                    <h3>Results</h3>
                    <div id="results"></div>
                </div>
                <div class="container" id="logging">
                    <h3>Logging</h3>
                    <div class="controls">
                        <button onclick="recordValues()">Record Value</button>
                        <button onclick="downloadCSV()">Download CSV</button>
                    </div>
                    <div id="effectLog">
                        <table>
                            <thead>
                                <tr>
                                    <th>Wire</th>
                                    <th>Electrical</th>
                                    <th>Magnetic</th>
                                    <th>Mechanical</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="effectLogBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="equations">
            <h3>Equations Used</h3>
            <p>ntp = (L_solenoid - (2 * L_soloff)) / D_wire</p>
            <p>n_layers = (2 / sqrt(3)) * ((R_max - R_min) / D_wire - 1) + 1</p>
            <p>n_T = ntp * n_layers</p>
            <p>lw = ∑_(x=1)^nlayers 2*pi*(Rx-Dwire)*q ; Here x = number of the layer from 1 to nlayers {very important to notice q here. q will be ntp for all odd layers so 1, 3, 5th layers etc. But for even layers it might be ntp-1 or ntp-2 based on the value of dwire. Idea is what multiple of dwire can fit in Lsolenoid.</p>
            <p>mw = Linear mass density * lw</p>
            <p>Hexagonal packing wire length formula (per layer):  
            lw = Σ<sub>x=1</sub><sup>n_layers</sup> 2 * π * (R_min + (x - 1) * ((√3 / 2) * D_wire)) * q  </p>
            <p>Assumptions for formulas used: Hexagonal packing of wires is assumed. Same q = ntp for all layers; in practice, for even layers, q may be ntp-1 or ntp-2 depending on how multiples of Dwire fit in the solenoid length.</p>
            <p>* Wire diameters are based on annealed standard copper at 20 °C from "Copper wire tables" by United States. National Bureau of Standards, Publication date 1914, https://nvlpubs.nist.gov/nistpubs/Legacy/hb/nbshandbook100.pdf</p>
            
        </div>
    </div>

    <script>
        function updateDynamicRange(sliderId, value) {
            const minValue = Math.max(value * 0.5, value - 50);
            const maxValue = Math.min(value * 1.5, value + 50);
            document.getElementById(sliderId + 'Value').textContent = value + (sliderId === 'solenoidLength' ? ' cm' : sliderId === 'linearOffset' ? ' mm' : sliderId === 'maxOuterRadius' || sliderId === 'innerRadius' ? ' cm' : sliderId === 'current' ? ' A' : '');
        }

        function syncInputs() {
            const inputs = ['solenoidLength', 'linearOffset', 'maxOuterRadius', 'innerRadius', 'wireDiameter', 'current', 'resistivity', 'linearMassDensity'];
            inputs.forEach(id => {
                let value = document.getElementById(id).value;
                if (id === 'wireDiameter') {
                    const insulation = parseFloat(document.getElementById('wireInsulationManual').value) || 0.025;
                    value = document.getElementById('wireDiameter').value || document.getElementById('wireDiameterManual').value || '0.259';
                    document.getElementById('wireDiameterManual').value = value !== document.getElementById('wireDiameter').value ? value : '';
                    document.getElementById('wireDiameter').value = value === document.getElementById('wireDiameterManual').value ? '' : value;
                    document.getElementById('wireDiameterValue').textContent = value + ' cm bare, ' + insulation + ' cm insulation';
                } else if (id === 'resistivity') {
                    value = document.getElementById('resistivity').value || document.getElementById('resistivityManual').value || '1.68';
                    document.getElementById('resistivityManual').value = value !== document.getElementById('resistivity').value ? value : '';
                    document.getElementById('resistivity').value = value === document.getElementById('resistivityManual').value ? '' : value;
                    document.getElementById('resistivityValue').textContent = value + ' ×10⁻⁶ Ω·cm';
                } else if (id === 'linearMassDensity') {
                    value = document.getElementById('linearMassDensity').value || document.getElementById('linearMassDensityManual').value || '8.9';
                    document.getElementById('linearMassDensityManual').value = value !== document.getElementById('linearMassDensity').value ? value : '';
                    document.getElementById('linearMassDensity').value = value === document.getElementById('linearMassDensityManual').value ? '' : value;
                    document.getElementById('linearMassDensityValue').textContent = value + ' g/cm';
                } else {
                    document.getElementById(id).value = value;
                    updateDynamicRange(id, parseFloat(value));
                }
            });
            calculate();
        }

        function toggleWireInput() {
            const dropdown = document.getElementById('wireDiameter');
            const manual = document.getElementById('wireDiameterManual');
            const insulation = document.getElementById('wireInsulationManual');
            const value = manual.value && manual.value !== '' ? manual.value : dropdown.value || '0.259';
            const insulValue = insulation.value || '0.025';
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
            }
            document.getElementById('wireDiameterValue').textContent = value + ' cm bare, ' + insulValue + ' cm insulation';
            syncInputs();
        }

        function toggleResistivity() {
            const dropdown = document.getElementById('resistivity');
            const manual = document.getElementById('resistivityManual');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('resistivityValue').textContent = manual.value + ' ×10⁻⁶ Ω·cm';
            } else if (dropdown.value) {
                manual.value = '';
                document.getElementById('resistivityValue').textContent = dropdown.value + ' ×10⁻⁶ Ω·cm';
            }
            syncInputs();
        }

        function toggleLinearMassDensity() {
            const dropdown = document.getElementById('linearMassDensity');
            const manual = document.getElementById('linearMassDensityManual');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('linearMassDensityValue').textContent = manual.value + ' g/cm';
            } else if (dropdown.value) {
                manual.value = '';
                document.getElementById('linearMassDensityValue').textContent = dropdown.value + ' g/cm';
            }
            syncInputs();
        }

        function calculate() {
            const solenoidLength = parseFloat(document.getElementById('solenoidLength').value) / 100; // Convert cm to m
            const linearOffset = parseFloat(document.getElementById('linearOffset').value) / 1000; // Convert mm to m
            const maxOuterRadius = parseFloat(document.getElementById('maxOuterRadius').value) / 100; // Convert cm to m
            const innerRadius = parseFloat(document.getElementById('innerRadius').value) / 100; // Convert cm to m
            const bareDiameter = parseFloat(document.getElementById('wireDiameter').value || document.getElementById('wireDiameterManual').value || '0.259'); // cm
            const wireInsulation = parseFloat(document.getElementById('wireInsulationManual').value) || 0.025; // cm
            const effectiveDiameter = bareDiameter + wireInsulation; // cm
            const effectiveDiameterM = effectiveDiameter / 100; // m
            const bareDiameterM = bareDiameter / 100; // m
            const linearMassDensity = parseFloat(document.getElementById('linearMassDensity').value || document.getElementById('linearMassDensityManual').value || '8.9');
            const maxLayersInput = parseFloat(document.getElementById('maxLayers').value) || Infinity;
            const maxThickness = parseFloat(document.getElementById('maxThickness').value) || Infinity;
            const maxWireLength = parseFloat(document.getElementById('maxWireLength').value) || Infinity;

            const ntp = Math.floor((solenoidLength - (2 * linearOffset)) / effectiveDiameterM);
            const nlayers = Math.floor(((2 / Math.sqrt(3)) * ((maxOuterRadius - innerRadius) / effectiveDiameterM - 1))+1);
            const nT = ntp * nlayers;

            //let l = 0;  // total wire length
            // let layerRadius = 0;  // radius to center of wire for current layer
            // const radialStep = (Math.sqrt(3) / 2) * effectiveDiameterM; // hexagonal packing step

            // for (let layer = 1; layer <= nlayers; layer++) {
            //     if (layer === 1) {
            //         // center of first layer
            //         layerRadius = innerRadius;
            //     } else {
            //         // move out by hexagonal packing radial step per layer
            //         layerRadius = innerRadius + (layer - 1) * radialStep;
            //     }

            //     l += ntp * 2 * Math.PI * layerRadius; // length for this layer
            // }
            // inputs defined: ntp, nlayers, Rmin, D_wire (all in meters)
            const lw = 2 * Math.PI * ntp * nlayers *( innerRadius + 0.5 * effectiveDiameterM + (Math.sqrt(3) / 4) * effectiveDiameterM * (nlayers - 1) );
            // const lw = l;
            
            const crossSectionArea = Math.PI * (bareDiameterM/2)*(bareDiameterM/2); // m²
            const volume = crossSectionArea * lw; // m³
            const mw = volume * 8920; // kg (density g/cm³ * volume m³ * 10^6 cm³/m³ / 1000 = kg)

            const totalThickness = effectiveDiameter * (1 + ((Math.sqrt(3) / 2) * (nlayers-1)))*10; // mm

            const layersClass = nlayers > maxLayersInput ? 'red' : 'green';
            const thicknessClass = totalThickness > maxThickness ? 'red' : 'green';
            const wireLengthClass = lw > maxWireLength ? 'red' : 'green';

            const nudge = (nlayers > maxLayersInput || totalThickness > maxThickness || lw > maxWireLength) ? 
                '<div class="nudge">Adjust inputs to meet restrictions.</div>' : '';

            document.getElementById('results').innerHTML = `
                <strong>Results:</strong><br>
                Number of Turns per Layer: ${ntp.toFixed(2)}<br>
                Number of Layers: <span class="${layersClass}">${nlayers.toFixed(0)}</span><br>
                Total Number of Turns: ${nT.toFixed(2)}<br>
                Wire Length: <span class="${wireLengthClass}">${lw.toFixed(2)}</span> m<br>
                Total Mass of Coil: ${mw.toFixed(2)} kg<br>
                Total Thickness: <span class="${thicknessClass}">${totalThickness.toFixed(2)}</span> mm
                ${nudge}
            `;
        }

        function recordValues() {
            const solenoidLength = parseFloat(document.getElementById('solenoidLength').value);
            const linearOffset = parseFloat(document.getElementById('linearOffset').value) / 10;
            const maxOuterRadius = parseFloat(document.getElementById('maxOuterRadius').value);
            const innerRadius = parseFloat(document.getElementById('innerRadius').value);
            const wireDiameter = parseFloat(document.getElementById('wireDiameter').value || document.getElementById('wireDiameterManual').value || '0.259');
            const current = parseFloat(document.getElementById('current').value);
            const resistivity = parseFloat(document.getElementById('resistivity').value || document.getElementById('resistivityManual').value || '1.68') * 1e-6;
            const linearMassDensity = parseFloat(document.getElementById('linearMassDensity').value || document.getElementById('linearMassDensityManual').value || '8.9');

            const wireColumn = `Wire Diameter: ${wireDiameter.toFixed(4)} cm`;
            const electricalColumn = `Current: ${current.toFixed(2)} A`;
            const magneticColumn = `N/A`;
            const mechanicalColumn = `Solenoid Length: ${solenoidLength.toFixed(2)} cm, Offset: ${linearOffset.toFixed(2)} cm`;

            const row = `<tr>
                <td>${wireColumn}</td>
                <td>${electricalColumn}</td>
                <td>${magneticColumn}</td>
                <td>${mechanicalColumn}</td>
                <td><button onclick="this.parentElement.parentElement.remove()">Delete</button></td>
            </tr>`;
            document.getElementById('effectLogBody').insertAdjacentHTML('afterbegin', row);
        }

        function downloadCSV() {
            const rows = Array.from(document.querySelectorAll('#effectLogBody tr'));
            const csv = [
                ['Wire (Diameter cm)', 'Electrical (Current A)', 'Magnetic', 'Mechanical (Solenoid Length cm, Offset cm)'].join(','),
                ...rows.map(row => Array.from(row.cells).slice(0, -1).map(cell => `"${cell.textContent}"`).join(','))
            ].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'solenoid_data.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        window.onload = syncInputs;
    </script>
</body>
</html>