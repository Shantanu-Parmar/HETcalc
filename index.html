<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solenoid Magnetic Field Optimizer</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: url('https://source.unsplash.com/random/1920x1080/?tech,abstract') no-repeat center center fixed;
            background-size: cover;
            color: #333;
        }
        h1 {
            text-align: center;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .main-content {
            display: flex;
            gap: 10px;
        }
        .left-pane {
            flex: 1;
            min-width: 0;
        }
        .right-pane {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .restrictions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .restrictions label {
            flex: 1;
            min-width: 120px;
        }
        .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }
        label {
            font-weight: bold;
            color: #2c3e50;
            font-size: 0.9em;
            min-width: 150px;
        }
        input[type="number"], select {
            padding: 6px;
            margin: 2px 0;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 0.9em;
            width: 80px;
        }
        .slider-value {
            font-size: 0.8em;
            color: #555;
            margin-left: 10px;
        }
        .insulation-note {
            font-size: 0.7em;
            color: #666;
            margin-left: 5px;
        }
        #result {
            margin: 0;
            font-size: 0.9em;
            padding: 10px;
            border-radius: 6px;
        }
        #effectLog {
            margin: 0;
            background: #fff;
            padding: 10px;
            border-radius: 6px;
            max-height: 150px;
            overflow-y: auto;
        }
        #effectLog table {
            width: 100%;
            border-collapse: collapse;
        }
        #effectLog th, #effectLog td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: center;
            font-size: 0.9em;
        }
        #effectLog td button {
            padding: 2px 5px;
            font-size: 0.7em;
        }
        canvas {
            display: none;
        }
        #chartError {
            display: none;
            color: red;
            text-align: center;
            margin: 10px 0;
            font-size: 0.9em;
        }
        .green { color: green; }
        .red { color: red; }
        .nudge { font-style: italic; font-size: 0.8em; color: #e74c3c; }
        .controls {
            text-align: center;
            margin: 10px 0;
        }
        @media (max-width: 600px) {
            .main-content {
                flex-direction: column;
            }
            .left-pane, .right-pane {
                width: 100%;
            }
            .input-row {
                flex-direction: column;
                align-items: stretch;
            }
            input[type="number"], select {
                width: 100%;
            }
            .restrictions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <h1>Solenoid Magnetic Field Optimizer</h1>
    <div class="calculator">
        <div class="main-content">
            <div class="left-pane">
                <div class="container" id="thresholds">
                    <h3>Thresholds</h3>
                    <div class="restrictions">
                        <label for="maxB">Max B (T):</label><input type="number" id="maxB" min="0" step="0.001" value="0.01" oninput="calculate()">
                        <label for="maxLayers">Max Layers:</label><input type="number" id="maxLayers" min="1" value="10" oninput="calculate()">
                        <label for="maxThickness">Max Thick (mm):</label><input type="number" id="maxThickness" min="0" step="0.1" value="10" oninput="calculate()">
                        <label for="maxWireLength">Max Wire (m):</label><input type="number" id="maxWireLength" min="0" step="0.1" value="50" oninput="calculate()">
                        <label for="maxPower">Max Power (W):</label><input type="number" id="maxPower" min="0" step="0.1" value="20" oninput="calculate()">
                        <label for="maxResistance">Max Resistance (Ω):</label><input type="number" id="maxResistance" min="0" step="0.1" value="10" oninput="calculate()">
                    </div>
                </div>
                <div class="container" id="inputParameters">
                    <h3>Input Parameters</h3>
                    <div class="input-row"><label for="turns">Turns (N):</label><input type="number" id="turns" value="100" oninput="syncInputs()"><span class="slider-value" id="turnsValue">100</span></div>
                    <div class="input-row"><label for="solenoidLength">Solenoid Length (cm):</label><input type="number" id="solenoidLength" value="50" step="0.1" oninput="syncInputs()"><span class="slider-value" id="solenoidLengthValue">50</span></div>
                    <div class="input-row"><label for="wireDiameter">Solenoid Wire Dia (cm):</label><select id="wireDiameter" onchange="toggleWireInput()">
                        <option value="0.0127">36 AWG (0.0102 cm + 0.0025 cm insul)</option>
                        <option value="0.1285">16 AWG (0.1025 cm + 0.026 cm insul)</option>
                        <option value="0.1274">18 AWG (0.1024 cm + 0.025 cm insul)</option>
                        <option value="0.1062">20 AWG (0.0812 cm + 0.025 cm insul)</option>
                        <option value="0.0894">22 AWG (0.0644 cm + 0.025 cm insul)</option>
                        <option value="0.0761">24 AWG (0.0511 cm + 0.025 cm insul)</option>
                        <option value="0.0655">26 AWG (0.0405 cm + 0.025 cm insul)</option>
                    </select><input type="number" id="wireDiameterManual" step="0.01" placeholder="Custom" oninput="toggleWireInput()" style="width: 80px;"><input type="number" id="wireInsulationManual" step="0.001" placeholder="Insul (cm)" value="0.025" oninput="toggleWireInput()" style="width: 80px;"><span class="insulation-note">(Default Insul: 0.025 cm)</span><span class="slider-value" id="wireDiameterValue">0.0127</span></div>
                    <div class="input-row"><label for="maxOuterRadius">Solenoid Max Outer Radius (cm):</label><input type="number" id="maxOuterRadius" value="10" step="0.1" oninput="syncInputs()"><span class="slider-value" id="maxOuterRadiusValue">10</span></div>
                    <div class="input-row"><label for="innerRadius">Solenoid Inner Radius (cm):</label><input type="number" id="innerRadius" value="5" step="0.1" oninput="syncInputs()"><span class="slider-value" id="innerRadiusValue">5</span></div>
                    <div class="input-row"><label for="current">Current (A):</label><input type="number" id="current" value="2" step="0.1" oninput="syncInputs()"><span class="slider-value" id="currentValue">2</span></div>
                    <div class="input-row"><label for="linearOffset">Linear Offset (mm):</label><input type="number" id="linearOffset" min="0" step="0.1" value="5" oninput="syncInputs()"><span class="slider-value" id="linearOffsetValue">5</span></div>
                    <div class="input-row"><label for="resistivity">Resistivity (×10⁻⁶ Ω·cm):</label><select id="resistivity" onchange="toggleResistivity()">
                        <option value="1.68">Copper (1.68)</option>
                        <option value="2.82">Aluminum (2.82)</option>
                        <option value="1.59">Silver (1.59)</option>
                        <option value="2.44">Gold (2.44)</option>
                    </select><input type="number" id="resistivityManual" step="0.01" placeholder="Custom" oninput="toggleResistivity()" style="width: 80px;"><span class="slider-value" id="resistivityValue">1.68</span></div>
                    <div class="input-row"><label for="linearMassDensity">Linear Mass Density (g/cm):</label><select id="linearMassDensity" onchange="toggleLinearMassDensity()">
                        <option value="8.9">Copper (8.9)</option>
                        <option value="2.7">Aluminum (2.7)</option>
                        <option value="10.36">Silver (10.36)</option>
                        <option value="19.32">Gold (19.32)</option>
                    </select><input type="number" id="linearMassDensityManual" step="0.01" placeholder="Custom" oninput="toggleLinearMassDensity()" style="width: 80px;"><span class="slider-value" id="linearMassDensityValue">8.9</span></div>
                </div>
            </div>
            <div class="right-pane">
                <div class="container" id="results">
                    <h3>Results</h3>
                    <div id="result"></div>
                </div>
                <div class="container" id="logging">
                    <h3>Logging</h3>
                    <div class="controls">
                        <button onclick="recordValues()">Record Value</button>
                        <button onclick="downloadCSV()">Download CSV</button>
                    </div>
                    <div id="effectLog">
                        <table>
                            <thead>
                                <tr>
                                    <th>Wire</th>
                                    <th>Electrical</th>
                                    <th>Magnetic</th>
                                    <th>Mechanical</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="effectLogBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function updateDynamicRange(sliderId, value) {
            const minValue = Math.max(value * 0.5, value - 50);
            const maxValue = Math.min(value * 1.5, value + 50);
            document.getElementById(sliderId + 'Value').textContent = value;
        }

        function syncInputs() {
            const inputs = ['turns', 'solenoidLength', 'wireDiameter', 'maxOuterRadius', 'innerRadius', 'current', 'linearOffset', 'resistivity', 'linearMassDensity'];
            inputs.forEach(id => {
                let value = document.getElementById(id).value;
                if (id === 'wireDiameter') {
                    const insulation = parseFloat(document.getElementById('wireInsulationManual').value) || 0.025;
                    value = document.getElementById('wireDiameter').value || document.getElementById('wireDiameterManual').value || '0.0127';
                    document.getElementById('wireDiameterManual').value = value !== document.getElementById('wireDiameter').value ? value : '';
                    document.getElementById('wireDiameter').value = value === document.getElementById('wireDiameterManual').value ? '' : value;
                    document.getElementById('wireDiameterValue').textContent = value;
                } else if (id === 'resistivity') {
                    value = document.getElementById('resistivity').value || document.getElementById('resistivityManual').value || '1.68';
                    document.getElementById('resistivityManual').value = value !== document.getElementById('resistivity').value ? value : '';
                    document.getElementById('resistivity').value = value === document.getElementById('resistivityManual').value ? '' : value;
                    document.getElementById('resistivityValue').textContent = value;
                } else if (id === 'linearMassDensity') {
                    value = document.getElementById('linearMassDensity').value || document.getElementById('linearMassDensityManual').value || '8.9';
                    document.getElementById('linearMassDensityManual').value = value !== document.getElementById('linearMassDensity').value ? value : '';
                    document.getElementById('linearMassDensity').value = value === document.getElementById('linearMassDensityManual').value ? '' : value;
                    document.getElementById('linearMassDensityValue').textContent = value;
                } else {
                    document.getElementById(id).value = value;
                    updateDynamicRange(id, parseFloat(value));
                }
            });
            calculate();
        }

        function toggleWireInput() {
            const dropdown = document.getElementById('wireDiameter');
            const manual = document.getElementById('wireDiameterManual');
            const insulation = document.getElementById('wireInsulationManual');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('wireDiameterValue').textContent = manual.value;
            } else if (dropdown.value) {
                manual.value = '';
                insulation.value = 0.025;
                document.getElementById('wireDiameterValue').textContent = dropdown.value;
            }
            syncInputs();
        }

        function toggleResistivity() {
            const dropdown = document.getElementById('resistivity');
            const manual = document.getElementById('resistivityManual');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('resistivityValue').textContent = manual.value;
            } else if (dropdown.value) {
                manual.value = '';
                document.getElementById('resistivityValue').textContent = dropdown.value;
            }
            syncInputs();
        }

        function toggleLinearMassDensity() {
            const dropdown = document.getElementById('linearMassDensity');
            const manual = document.getElementById('linearMassDensityManual');
            if (manual.value && manual.value !== '') {
                dropdown.value = '';
                document.getElementById('linearMassDensityValue').textContent = manual.value;
            } else if (dropdown.value) {
                manual.value = '';
                document.getElementById('linearMassDensityValue').textContent = dropdown.value;
            }
            syncInputs();
        }

        function recordValues() {
            const turns = parseFloat(document.getElementById('turns').value);
            const solenoidLength = parseFloat(document.getElementById('solenoidLength').value);
            const wireDiameter = parseFloat(document.getElementById('wireDiameter').value || document.getElementById('wireDiameterManual').value || '0.0127');
            const maxOuterRadius = parseFloat(document.getElementById('maxOuterRadius').value);
            const innerRadius = parseFloat(document.getElementById('innerRadius').value);
            const current = parseFloat(document.getElementById('current').value);
            const linearOffset = parseFloat(document.getElementById('linearOffset').value) / 10;
            const resistivity = parseFloat(document.getElementById('resistivity').value || document.getElementById('resistivityManual').value || '1.68') * 1e-6;
            const linearMassDensity = parseFloat(document.getElementById('linearMassDensity').value || document.getElementById('linearMassDensityManual').value || '8.9');

            const mu0 = 4 * Math.PI * 1e-7;
            const wireThickness = wireDiameter / 100;
            const solenoidLengthM = solenoidLength / 100;
            const maxOuterRadiusM = maxOuterRadius / 100;
            const innerRadiusM = innerRadius / 100;
            const radialDiff = maxOuterRadiusM - innerRadiusM;
            const maxLayers = Math.min(Math.floor((2 / Math.sqrt(3)) * ((radialDiff / (wireDiameter / 100)) - 1)), parseFloat(document.getElementById('maxLayers').value) || Infinity);
            const n = turns / solenoidLengthM;
            const B = mu0 * n * current;

            let wireLength = 0;
            const turnsPerLayer = turns / maxLayers;
            for (let layer = 1; layer <= maxLayers; layer++) {
                const layerRadius = innerRadiusM + (wireDiameter / 100) + ((Math.sqrt(3) / 2) * (layer - 1) * (wireDiameter / 100));
                wireLength += turnsPerLayer * 2 * Math.PI * layerRadius;
            }

            const crossSectionArea = Math.PI * (wireThickness / 2) ** 2;
            const resistance = resistivity * (wireLength / crossSectionArea);
            const power = Math.pow(current, 2) * resistance;
            const voltage = current * resistance;
            const totalThickness = wireDiameter * (1 + (Math.sqrt(3) / 2) * maxLayers);
            const wireMass = wireLength * 100 * linearMassDensity / 1000;

            const wireColumn = `Mass: ${wireMass.toFixed(2)} kg, Length: ${wireLength.toFixed(2)} m`;
            const electricalColumn = `Power: ${power.toFixed(2)} W, Current: ${current} A, Resistance: ${resistance.toFixed(2)} Ω, Voltage: ${voltage.toFixed(2)} V`;
            const magneticColumn = `B: ${B.toFixed(6)} T`;
            const mechanicalColumn = `Layers: ${maxLayers}, Total Thickness: ${(totalThickness * 10).toFixed(2)} mm`;

            const row = `<tr>
                <td>${wireColumn}</td>
                <td>${electricalColumn}</td>
                <td>${magneticColumn}</td>
                <td>${mechanicalColumn}</td>
                <td><button onclick="this.parentElement.parentElement.remove()">Delete</button></td>
            </tr>`;
            document.getElementById('effectLogBody').insertAdjacentHTML('afterbegin', row);
        }

        function downloadCSV() {
            const rows = Array.from(document.querySelectorAll('#effectLogBody tr'));
            const csv = [
                ['Wire (Mass kg, Length m)', 'Electrical (Power W, Current A, Resistance Ω, Voltage V)', 'Magnetic (B T)', 'Mechanical (Layers, Total Thickness mm)'].join(','),
                ...rows.map(row => Array.from(row.cells).slice(0, -1).map(cell => `"${cell.textContent}"`).join(','))
            ].join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'solenoid_data.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function calculate() {
            const turns = parseFloat(document.getElementById('turns').value);
            const solenoidLength = parseFloat(document.getElementById('solenoidLength').value);
            const wireDiameter = parseFloat(document.getElementById('wireDiameter').value || document.getElementById('wireDiameterManual').value || '0.0127');
            const maxOuterRadius = parseFloat(document.getElementById('maxOuterRadius').value);
            const innerRadius = parseFloat(document.getElementById('innerRadius').value);
            const current = parseFloat(document.getElementById('current').value);
            const linearOffset = parseFloat(document.getElementById('linearOffset').value) / 10;
            const resistivity = parseFloat(document.getElementById('resistivity').value || document.getElementById('resistivityManual').value || '1.68') * 1e-6;
            const linearMassDensity = parseFloat(document.getElementById('linearMassDensity').value || document.getElementById('linearMassDensityManual').value || '8.9');
            const maxLayersInput = parseFloat(document.getElementById('maxLayers').value) || Infinity;

            const mu0 = 4 * Math.PI * 1e-7;
            const wireThickness = wireDiameter / 100;
            const solenoidLengthM = solenoidLength / 100;
            const maxOuterRadiusM = maxOuterRadius / 100;
            const innerRadiusM = innerRadius / 100;
            const radialDiff = maxOuterRadiusM - innerRadiusM;
            const maxLayers = Math.min(Math.floor((2 / Math.sqrt(3)) * ((radialDiff / (wireDiameter / 100)) - 1)), maxLayersInput);
            const n = turns / solenoidLengthM;
            const B = mu0 * n * current;

            let wireLength = 0;
            const turnsPerLayer = turns / maxLayers;
            for (let layer = 1; layer <= maxLayers; layer++) {
                const layerRadius = innerRadiusM + (wireDiameter / 100) + ((Math.sqrt(3) / 2) * (layer - 1) * (wireDiameter / 100));
                wireLength += turnsPerLayer * 2 * Math.PI * layerRadius;
            }

            const crossSectionArea = Math.PI * (wireThickness / 2) ** 2;
            const resistance = resistivity * (wireLength / crossSectionArea);
            const power = Math.pow(current, 2) * resistance;
            const voltage = current * resistance;
            const totalThickness = wireDiameter * (1 + (Math.sqrt(3) / 2) * maxLayers);
            const wireMass = wireLength * 100 * linearMassDensity / 1000;

            const maxB = parseFloat(document.getElementById('maxB').value) || Infinity;
            const maxThickness = parseFloat(document.getElementById('maxThickness').value) / 10 || Infinity;
            const maxWireLength = parseFloat(document.getElementById('maxWireLength').value) || Infinity;
            const maxPower = parseFloat(document.getElementById('maxPower').value) || Infinity;
            const maxResistance = parseFloat(document.getElementById('maxResistance').value) || Infinity;

            const bClass = B > maxB ? 'red' : 'green';
            const layersClass = maxLayers > maxLayersInput ? 'red' : 'green';
            const thicknessClass = totalThickness > maxThickness ? 'red' : 'green';
            const wireLengthClass = wireLength > maxWireLength ? 'red' : 'green';
            const powerClass = power > maxPower ? 'red' : 'green';
            const resistanceClass = resistance > maxResistance ? 'red' : 'green';
            const nudge = (B > maxB || maxLayers > maxLayersInput || totalThickness > maxThickness || wireLength > maxWireLength || power > maxPower || resistance > maxResistance) ?
                '<div class="nudge">Adjust inputs to meet restrictions.</div>' : '';

            document.getElementById('result').innerHTML = `
                <strong>Results:</strong><br>
                <strong>Wire:</strong> Mass: ${wireMass.toFixed(2)} kg, Length: ${wireLength.toFixed(2)} m<br>
                <strong>Electrical:</strong> Power: <span class="${powerClass}">${power.toFixed(2)}</span> W, Current: ${current} A, Resistance: <span class="${resistanceClass}">${resistance.toFixed(2)}</span> Ω, Voltage: ${voltage.toFixed(2)} V<br>
                <strong>Magnetic:</strong> B: <span class="${bClass}">${B.toFixed(6)}</span> T<br>
                <strong>Mechanical:</strong> Layers: <span class="${layersClass}">${maxLayers}</span>, Total Thickness: <span class="${thicknessClass}">${(totalThickness * 10).toFixed(2)}</span> mm
                ${nudge}
            `;
        }

        window.onload = syncInputs;
    </script>
</body>
</html>
